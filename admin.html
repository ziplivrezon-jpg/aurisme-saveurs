<!DOCTYPE html>
<html lang="ht">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurisme Admin - Sekirize & Netwaye</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bordeaux: #800000; --gold: #DAA520; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #login-box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 320px; }
        .pin-input { width: 100%; padding: 15px; font-size: 24px; text-align: center; border: 2px solid #ddd; border-radius: 12px; margin-bottom: 20px; letter-spacing: 5px; }
        #admin-panel { display: none; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px; border-top: 10px solid var(--bordeaux); }
        h2 { color: var(--bordeaux); text-align: center; }
        label { font-size: 14px; font-weight: bold; color: #555; display: block; margin-top: 15px; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-update { background: var(--bordeaux); color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 25px; }
        #status-msg { text-align: center; margin-top: 15px; font-weight: bold; display: none; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="login-box">
        <img src="Logo.png" width="80" style="border-radius: 50%; margin-bottom: 15px; border: 2px solid var(--gold);">
        <h3>Admin Access</h3>
        <input type="password" id="adminPin" class="pin-input" maxlength="4" placeholder="****">
        <button class="btn-update" onclick="checkPin()">Konekte</button>
    </div>

    <div id="admin-panel">
        <h2>Aurisme Control</h2>
        
        <label>ID K√≤mand (Ex: AUR001)</label>
        <input type="text" id="orderID" placeholder="ID k√≤mand an">

        <label>Estati K√≤mand lan</label>
        <select id="orderStatus">
            <option value="K√≤mand Resevwa ‚úÖ">‚úÖ Resevwa</option>
            <option value="Nan Preparasyon üç≥">üç≥ Nan Preparasyon</option>
            <option value="Nan Wout üõµ">üõµ Nan Wout</option>
            <option value="Livre ak Siks√® üèÅ">üèÅ Livre</option>
            <option value="K√≤mand Anile ‚ùå">‚ùå Anile</option>
        </select>

        <label>Non Livreur a</label>
        <input type="text" id="courierName" placeholder="Ex: Jean / Pierre">

        <button class="btn-update" onclick="updateFirebase()">Mete a Jou nan Cloud</button>
        <div id="status-msg"></div>
        
        <p onclick="location.reload()" style="text-align:center; font-size:12px; color:#999; cursor:pointer; margin-top:20px;">D√©connexion</p>
    </div>

<script>
    // 1. CONFIGURATION FIREBASE (REMETE PA W LA)
    const firebaseConfig = { apiKey: "AIza...", projectId: "aurisme-app", appId: "1:..." };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 2. TCHEKE PIN AK NETWAYE BAZ DONE A
    function checkPin() {
        const pin = document.getElementById('adminPin').value;
        const secretPin = "2024"; 

        if(pin === secretPin) {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            
            // L√® w konekte, li efase vye k√≤mand ki gen plis pase 24h
            cleanOldOrders();
        } else {
            alert("K√≤d la pa bon!");
            document.getElementById('adminPin').value = "";
        }
    }

    // 3. FONKSYON NETWAYAJ OTOMATIK (24H)
    async function cleanOldOrders() {
        const limitTan = Date.now() - (24 * 60 * 60 * 1000); // 24 √®dtan nan milisegonn
        try {
            const snapshot = await db.collection("orders_tracking")
                .where("timestamp", "<", firebase.firestore.Timestamp.fromMillis(limitTan))
                .get();

            const batch = db.batch();
            snapshot.forEach(doc => {
                batch.delete(doc.ref);
            });
            await batch.commit();
            console.log("Netwayaj otomatik f√®t: Vye done yo efase.");
        } catch (e) { console.error("Er√® netwayaj:", e); }
    }

    // 4. MIZAJOU FIREBASE
    async function updateFirebase() {
        const id = document.getElementById('orderID').value.trim().toUpperCase();
        const status = document.getElementById('orderStatus').value;
        const courier = document.getElementById('courierName').value;
        const msgDiv = document.getElementById('status-msg');

        if(!id) return alert("Antre ID k√≤mand lan!");

        msgDiv.style.display = "block";
        msgDiv.innerText = "Mizajou an kouran...";
        msgDiv.style.background = "#eee";

        try {
            await db.collection("orders_tracking").doc(id).set({
                status: status,
                courier: courier || "Ekip Aurisme",
                lastUpdate: new Date().toLocaleString('fr-FR', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' }),
                timestamp: firebase.firestore.FieldValue.serverTimestamp() // S√®vi pou konnen laj k√≤mand lan
            });
            msgDiv.innerText = "Mizajou f√®t! Kliyan an ap tande son an. üéâ";
            msgDiv.style.background = "#d4edda";
            msgDiv.style.color = "green";
            
            setTimeout(() => { msgDiv.style.display = "none"; }, 3000);
        } catch (error) {
            msgDiv.innerText = "Er√®: " + error.message;
            msgDiv.style.background = "#f8d7da";
        }
    }
</script>
</body>
</html>
