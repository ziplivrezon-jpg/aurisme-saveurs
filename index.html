<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAkvQekoI6G-yJw4df_ItkWjUrKTBgmSpQ",
            authDomain: "aurisme-app.firebaseapp.com",
            projectId: "aurisme-app",
            storageBucket: "aurisme-app.firebasestorage.app",
            messagingSenderId: "1037465492868",
            appId: "1:1037465492868:web:a68723e9bdfb93966891d1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. RANJE PWOBLEM MAJISKIL LA
        window.showLoginModal = async function() {
            let rawName = prompt("Antre NON ou pou w w√® pwen kado ou yo (Ex: Pierre) :");
            if (rawName) {
                // Nou f√≤se non an vinn an Majiskil pou l ka match ak Firebase
                let name = rawName.trim().toUpperCase(); 
                try {
                    // Ch√®che nan koleksyon "clients_points" (Asire w ID yo an majiskil nan Firebase)
                    const docRef = doc(db, "clients_points", name);
                    const docSnap = await getDoc(docRef);
                    
                    if (docSnap.exists()) {
                        localStorage.setItem('aurisme_user', name);
                        location.reload(); 
                    } else {
                        alert("Non '" + name + "' pa nan lis VIP a. Tcheke si w byen tape l oswa mande admin k√≤d ou!");
                    }
                } catch (e) { alert("Er√®: " + e.message); }
            }
        };

        // 2. MONTE KATALOG LA AK BOUTON WHATSAPP LA
        window.updateUI = async function() {
            const user = localStorage.getItem('aurisme_user');
            const rewardsSection = document.getElementById('rewards-section');
            const authControls = document.getElementById('auth-controls');
            
            if (user && db) {
                const docRef = doc(db, "clients_points", user);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    let pts = data.points !== undefined ? data.points : (data.Points || 0);
                    
                    document.getElementById('guest-msg').innerText = "Bienvenue, " + user + " !";
                    authControls.innerHTML = `<span style="font-weight:bold; color:var(--navy)">Bonjour, ${user}!</span> <button class="btn-login-top" style="background:var(--bordeaux)" onclick="logoutUser()">D√©connexion</button>`;
                    
                    if(rewardsSection) {
                        rewardsSection.style.display = 'block';
                        // Afiche pwen yo
                        document.getElementById('user-points').innerText = pts + " Points";
                        
                        // AJOUTE KATALOG AK BOUTON WHATSAPP
                        rewardsSection.innerHTML = `
                            <div class="rewards-badge">MEMBRE VIP</div>
                            <h3>üéÅ Mes Points Aurisme</h3>
                            <div class="points-display">${pts} Points</div>
                            
                            <div style="margin-top: 15px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; font-size: 13px;">
                                <h4 style="margin:0; color: var(--gold);">Kado ou ka jwenn:</h4>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li>üé´ 50 pts: 10% Rab√®</li>
                                    <li>üõµ 150 pts: 1 Kous Gratis</li>
                                    <li>üßÅ 300 pts: 1 Douzaine Cupcakes</li>
                                </ul>
                            </div>

                            <button onclick="reclamerPwen('${user}', ${pts})" 
                                style="width:100%; background:#25D366; color:white; border:none; padding:12px; border-radius:10px; margin-top:15px; font-weight:bold; cursor:pointer;">
                                üì± Echanje pwen m sou WhatsApp
                            </button>
                        `;
                    }
                }
            }
        };

        window.reclamerPwen = function(name, pts) {
            const msg = encodeURIComponent(`*RECLAMATION POINTS VIP*\n\nBonjou Aurisme! Mwen se *${name}*.\nMwen gen *${pts}* pwen e mwen ta renmen konnen ki kado mwen ka pran.`);
            window.open(`https://wa.me/50942017744?text=${msg}`, '_blank');
        };

        window.logoutUser = function() {
            localStorage.removeItem('aurisme_user');
            location.reload();
        };

        document.getElementById('login-btn-action').onclick = window.showLoginModal;
        window.onload = window.updateUI;
            </script>
